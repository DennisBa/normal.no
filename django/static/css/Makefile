# Converts all less files to css and compress them.
# @todo prefix or put autogenerated css files in own directory?
# @todo add check to main target?

.PHONY: all clean check

LESSC=lessc
LESSCFLAGS=--no-js --clean-css --compress
# Note: --clean-css compress a little bit better than --compress
# Update: With Debians node-less (1.4.2), --clean-css does not compress!

cssfiles := $(patsubst %.less,%.css,$(wildcard *.less))


all: all.css tinymce.css

# content_css: '/static/css/tinymce.css
#tinymce.css: style.css classes.css
tinymce.css: style.css classes.css sections.css
	cat $^ > $@

all.css: $(cssfiles)
	cat $(cssfiles) > all.css
	@# join all lines. @todo remove extra whitespace
	@#cat $(cssfiles) | fmt -w 8192 > all.css


check:
	@for file in *.less ; do	\
	    echo Checking $$file ... ;	\
	    $(LESSC) --lint $$file ;	\
	done

clean:
	rm -fv all.css tinymce.css
	rm -fv $(cssfiles)


%.css : %.less
	@if [ x = x`/bin/which $(LESSC)` ]; then		\
	    echo "Error: The lessc compiler is missing!";	\
	    echo "Install it with: apt-get install node-less";	\
	    exit 1;						\
	fi
	$(LESSC) $(LESSCFLAGS) $^ > $@
